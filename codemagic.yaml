version: 1.0.0

trigger:
  branch:
    - master
    - main

workflows:
  android-alpha-build:
    name: Android Alpha Build (Cordova)
    instance_type: mac_mini_m2
    environment:
      java: 21
      node: 18
      vars:
        CORDOVA_ANDROID_VERSION: "12.0.0"

    scripts:
      - name: Install Cordova CLI
        script: |
          npm install -g cordova

      - name: Install Android SDK tools + accept licenses
        script: |
          yes | sdkmanager --licenses || true
          sdkmanager "platform-tools" "platforms;android-34" "build-tools;34.0.0"

      - name: Prepare platform
        script: |
          if [ ! -d "platforms/android" ]; then
            cordova platform add android@$CORDOVA_ANDROID_VERSION
          else
            cordova prepare android
          fi

      - name: Build APK
        script: |
          cordova build android --debug

      - name: Locate & copy APK
        script: |
          APK_PATH=$(find platforms/android/app/build/outputs/apk/debug -name "*.apk" | head -1)

          if [ -f "$APK_PATH" ]; then
            cp "$APK_PATH" app-debug.apk
            echo "SUCCESS: APK copied â†’ app-debug.apk"
          else
            echo "ERROR: APK not found!"
            exit 1
          fi

    artifacts:
      - app-debug.apk
      - platforms/android/app/build/outputs/**/*.apk
